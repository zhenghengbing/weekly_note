# B 树、B+ 树

参考资料：https://github.com/julycoding/The-Art-Of-Programming-By-July/blob/master/ebook/zh/03.02.md

磁盘读写分为：查找时间（最大0.1s）、等待时间（一圈大约 0.0083s）、传输时间(一个字节大约 0.02us)

* B树、 B+ 树核心目的：降低磁盘 I/O 操作。

* B树提高了磁盘 IO 性能但元素遍历效率低下，于是出现 B+树。

  B+ 树只要遍历叶节点就能实现树的完整遍历，还支持范围查询。

## B 树

    概述：B 树是为了磁盘或其它存储设备而设计的一种多叉（下面你会看到，相对于二叉，
    B树每个内结点有多个分支，即多叉）平衡查找树，主要作用是降低磁盘I/0操作。
    
### B 树特性（m 阶）

* 每个节点最多含有 m 个孩子（m>=2）

* 每个节点最少含有 ceil(m/2) 个孩子（ceil 向上取整）

* 根节点至少 2 个孩子（B 树只包含一个节点除外）

* 所有叶子节点都在同一层

* 每个非终端包含 n 个关键字信息(n, P0, K1, P1, K2,..., Kn, Pn)
    
#### INSERT

* 插入元素 I，找到 I 属于哪个节点，插入数据

* 若该节点元素个数 > m - 1 （除根节点，根节点 > m 拆分）

    * 拆分当前节点：把中间元素提到父节点

#### DELETE

* 查找待删除元素 D 是否在树中，在树中找到该元素

* 看 D 是否有孩子节点

    * 有孩子节点，上移某相近元素（左节点最右元素、右节点最左元素）
    
    * 没孩子节点直接删除
    
* 删除后恢复 B 树性质

    * 若某节点元素少于  ceil(m/2) - 1，检查相邻兄弟节点是否丰满（节点数 > ceil(m /2) - 1）
    
        * 若都丰满，向父节点借一个元素
        
          借完元素和父节点少了一个，子节点也需要减一个或者找一个子节点借一个元素。
        
        * 将该节点与未丰满的兄弟节点合并

## B+ 树

概述：B+ 树数据只存储在叶子节点，内部节点只存索引，这样带来好处：

* 索引占内存小，一次能读入更多的索引

* 只要遍历页节点就能实现树的遍历，支持了范围查询。